<script>
const input=document.getElementById("userInput");
const chat=document.getElementById("chatArea");
const sendBtn=document.getElementById("sendBtn");
const micBtn=document.getElementById("micBtn");
const darkToggle=document.getElementById("darkToggle");

const WEBHOOK_URL = "https://n8n-oazxlbnc.us-west-1.clawcloudrun.com/webhook-test/0c2786aa-168f-4877-b716-869dd1c43095";

darkToggle.onclick=()=>{
 document.body.classList.toggle("dark");
 darkToggle.textContent=document.body.classList.contains("dark")?"‚òÄ":"üåô";
};

function now(){
 return new Date().toLocaleTimeString([],{
  hour:'2-digit',minute:'2-digit'
 });
}

function scrollBottom(){
 chat.scrollTop=chat.scrollHeight;
}

sendBtn.onclick=sendMessage;
input.addEventListener("keydown",e=>{
 if(e.key==="Enter") sendMessage();
});

function sendMessage(){
 const text=input.value.trim();
 if(!text)return;

 // User message
 const user=document.createElement("div");
 user.className="message user";
 user.innerHTML=`${text}<div class="time">${now()}</div>`;
 chat.appendChild(user);
 input.value="";
 scrollBottom();

 // Typing indicator
 const typing=document.createElement("div");
 typing.className="message ai typing";
 typing.innerHTML="NIDAAN is typing...";
 chat.appendChild(typing);
 scrollBottom();

 // Send to webhook
 fetch(WEBHOOK_URL, {
   method: "POST",
   headers: {
     "Content-Type": "application/json"
   },
   body: JSON.stringify({
     message: text
   })
 })
 .then(res => res.json())
 .then(data => {
   typing.remove();

   const reply = data.reply || data.output || JSON.stringify(data);

   const ai=document.createElement("div");
   ai.className="message ai";
   ai.innerHTML=`${reply}<div class="time">${now()}</div>`;
   chat.appendChild(ai);
   scrollBottom();
 })
 .catch(err => {
   typing.remove();

   const ai=document.createElement("div");
   ai.className="message ai";
   ai.innerHTML=`‚ö†Ô∏è Error connecting to server<div class="time">${now()}</div>`;
   chat.appendChild(ai);
   scrollBottom();
 });
}
</script>
