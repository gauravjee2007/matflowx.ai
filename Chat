<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>NIDAAN MATFLOW â€“ Chat</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{
  box-sizing:border-box;
  font-family:"Helvetica Neue",Helvetica,Arial,system-ui,-apple-system,sans-serif;
}

body{
  margin:0;
  background:#eaf5f3;
  height:100vh;
  overflow:hidden;
}

/* ================= HEADER ================= */
header{
  position:fixed;
  top:0; left:0;
  width:100%;
  z-index:100;
  background:linear-gradient(135deg,#075e54,#128c7e);
  color:#fff;
  text-align:center;
  padding:14px 18px 16px;
}

/* MAIN TITLE */
.title-main{
  font-size:30px;
  font-weight:700;
  letter-spacing:1px;
  line-height:1.1;
}

/* SUB TITLE */
.title-sub{
  font-size:13px;
  font-style:italic;
  color:#d7ebe6;          /* lighter gray */
  margin-top:6px;        /* spacing adjust */
  line-height:1.2;
}

#darkToggle{
  position:absolute;
  right:16px;
  top:14px;
  width:40px;
  height:40px;
  border-radius:50%;
  border:none;
  cursor:pointer;
  font-size:18px;
  background:rgba(255,255,255,0.25);
  color:#fff;
}

/* ================= CHAT ================= */
.chat-area{
  position:absolute;
  top:78px;
  bottom:76px;
  left:0; right:0;
  padding:16px;
  overflow-y:auto;
  display:flex;
  flex-direction:column;
  gap:14px;
  scroll-behavior:smooth;
}

.message{
  padding:9px 13px;
  border-radius:12px;
  max-width:65%;
  font-size:18px;
  line-height:1.5;
  box-shadow:0 1px 6px rgba(0,0,0,0.12);
  white-space: pre-wrap;
}

/* USER */
.user{
  align-self:flex-end;
  background:#d9fdd3;
  color:#000000;
}

/* AI */
.ai{
  align-self:flex-start;
  background:#ffffff;
  color:#111;
}

/* THINKING / TYPING */
.thinking{background:#eefaf6;font-weight:600;}
.typing{background:#def5ee;font-weight:600;}

.dots::after{
  content:'';
  display:inline-block;
  width:1.2em;
  animation:dots 1.4s steps(3,end) infinite;
}
@keyframes dots{
  0%{content:'';}
  33%{content:'.';}
  66%{content:'..';}
  100%{content:'...';}
}

.time{
  font-size:11px;
  opacity:0.6;
  margin-top:4px;
  text-align:right;
}

/* ================= FOOTER ================= */
footer{
  position:fixed;
  bottom:0; left:0;
  width:100%;
  z-index:100;
  display:flex;
  gap:10px;
  padding:10px;
  background:#f0fdfa;
  border-top:1px solid #b2dfdb;
}

input{
  flex:1;
  padding:12px 14px;
  font-size:15px;
  border-radius:22px;
  border:1px solid #9fd6c9;
}

/* BUTTONS */
button{
  width:46px;
  height:46px;
  border-radius:50%;
  border:none;
  font-size:18px;
  cursor:pointer;
}

#sendBtn{background:#128c7e;color:#fff;}
#micBtn{background:#075e54;color:#fff;}
#micBtn.listening{background:#c62828;}

/* ================= DARK MODE ================= */
body.dark{
  background:#000000;
}
body.dark footer{
  background:#000000;
  border-top:1px solid #222;
}
body.dark input{
  background:#0b0b0b;
  color:#fff;
  border-color:#333;
}
body.dark .ai{
  background:#1f2933;
  color:#e5fdf6;
  box-shadow:0 2px 10px rgba(255,255,255,0.08);
}
body.dark .user{
  background:#9ae6b4;
  color:#000000;
}
</style>
</head>

<body>

<header>
  <div class="title-main">NIDAAN MATFLOW</div>
  <div class="title-sub">(Your Intelligent Material Management)</div>
  <button id="darkToggle" type="button">ðŸŒ™</button>
</header>

<div class="chat-area" id="chatArea">
  <div class="message ai">
    Hello ðŸ‘‹ Iâ€™m <b>NIDAAN</b> â€” Your Intelligent Material Management Solution. How May I help You ?
    <div class="time"></div>
  </div>
</div>

<footer>
  <input id="userInput" type="text" placeholder="Type your query..." autocomplete="off">
  <button id="micBtn" type="button">ðŸŽ™</button>
  <button id="sendBtn" type="button">âž¤</button>
</footer>

<script>
function renderMarkdown(text){
  if(!text) return "";
  return text.replace(/\*\*(.*?)\*\*/g,"<b>$1</b>").replace(/\n/g,"<br>");
}

const input=document.getElementById("userInput");
const chat=document.getElementById("chatArea");
const sendBtn=document.getElementById("sendBtn");
const micBtn=document.getElementById("micBtn");
const darkToggle=document.getElementById("darkToggle");

darkToggle.onclick=()=>{
 document.body.classList.toggle("dark");
 darkToggle.textContent=document.body.classList.contains("dark")?"â˜€":"ðŸŒ™";
};

function now(){
 return new Date().toLocaleTimeString([],{
  hour:'2-digit',minute:'2-digit'
 });
}

function scrollBottom(){
 chat.scrollTop=chat.scrollHeight;
}

input.addEventListener("keydown",e=>{
 if(e.key==="Enter"){e.preventDefault();sendMessage();}
});

let recognition=null;
if(window.SpeechRecognition||window.webkitSpeechRecognition){
 const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
 recognition=new SR();
 recognition.lang="en-IN";
 recognition.onresult=e=>{input.value=e.results[0][0].transcript;};
 recognition.onend=()=>micBtn.classList.remove("listening");
}

micBtn.onclick=()=>{
 if(!recognition)return;
 micBtn.classList.add("listening");
 recognition.start();
};

sendBtn.onclick=sendMessage;

function sendMessage(){
 const text=input.value.trim();
 if(!text)return;

 const user=document.createElement("div");
 user.className="message user";
 user.innerHTML=`${text}<div class="time">${now()}</div>`;
 chat.appendChild(user);
 scrollBottom();
 input.value="";

 const thinking=document.createElement("div");
 thinking.className="message ai thinking";
 thinking.innerHTML=`NIDAAN AI is thinking<span class="dots"></span>`;
 chat.appendChild(thinking);
 scrollBottom();

 setTimeout(()=>{
  thinking.remove();
  const typing=document.createElement("div");
  typing.className="message ai typing";
  typing.innerHTML=`NIDAAN AI is typing<span class="dots"></span>`;
  chat.appendChild(typing);
  scrollBottom();

  fetch("https://n8n-oazxlbnc.us-west-1.clawcloudrun.com/webhook/1gIGDU",{
   method:"POST",
   headers:{"Content-Type":"application/json"},
   body:JSON.stringify({message:text})
  })
  .then(r=>r.json())
  .then(d=>{
   typing.remove();
   const ai=document.createElement("div");
   ai.className="message ai";
   ai.innerHTML=`${renderMarkdown(d.reply)}<div class="time">${now()}</div>`;
   chat.appendChild(ai);
   scrollBottom();
  });
 },900);
}

window.onload=scrollBottom;
</script>

</body>
</html>
